<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ ä¸‰è§’æ¸¬é‡è¦–è¦ºåŒ–é«”é©— (è¡Œå‹•å„ªåŒ–ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/renderers/CSS2DRenderer.js"></script>
    
    <style>
        /* æ ¸å¿ƒä½ˆå±€ä¿®æ­£ï¼šç¸±å‘ Flex å®¹å™¨ */
        body { 
            margin: 0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            width: 100%;
            background-color: #f4f7f9; 
            overflow: hidden;
        }
        
        /* --- 1. ä¸Šæ–¹ï¼šæ§åˆ¶é¢æ¿ --- */
        #controls { 
            width: 100%; 
            height: 450px; /* å›ºå®šçš„åˆå§‹é«˜åº¦ */
            padding: 15px 20px; 
            background-color: #ffffff; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            overflow-y: auto; 
            box-sizing: border-box;
        }
        
        /* è¼¸å…¥å€å¡Šé…ç½®ï¼šPC/å¹³æ¿ä¸Šä¸¦æ’ï¼Œæ‰‹æ©Ÿä¸Šå †ç–Š */
        #input-content { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 20px; 
            justify-content: flex-start;
        }
        #input-content > div { 
            width: calc(33% - 14px); /* å¤§è¢å¹•ä¸Šä¸‰æ¬„ */
            min-width: 250px; /* æœ€å°å¯¬åº¦ä¿éšœ */
        }

        /* æ‰‹æ©Ÿä»‹é¢å„ªåŒ–ï¼šåœ¨è¢å¹•å¯¬åº¦å°æ–¼ 768px æ™‚ï¼Œè¼¸å…¥å€å¡Šä½”æ»¿å¯¬åº¦ä¸¦å †ç–Š */
        @media (max-width: 768px) {
            #controls {
                height: 50vh; /* æ‰‹æ©Ÿä¸Šï¼Œè®“æ§åˆ¶å€ä½”æ“šä¸€åŠè¢å¹•é«˜åº¦ */
            }
            #input-content > div {
                width: 100%; /* å¼·åˆ¶å †ç–Š */
                min-width: unset;
            }
        }
        
        /* (å…¶ä»– CSS æ¨£å¼ä¿æŒä¸è®Š) */
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .setting-group { margin-bottom: 15px; padding: 15px; border: 1px solid #bdc3c7; border-radius: 6px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #34495e; }
        input[type="number"], select { width: 100px; padding: 6px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .azimuth-input { display: flex; gap: 5px; align-items: center; margin-bottom: 8px; }
        .azimuth-input select { width: 60px; margin-bottom: 0; }
        .azimuth-input input[type="number"] { width: 80px; margin-bottom: 0; }

        .control-buttons { display: flex; flex-direction: column; gap: 8px; }
        .control-row { display: flex; justify-content: space-between; gap: 10px; }
        .control-row button { padding: 8px 15px; border: 1px solid #ccc; border-radius: 4px; background-color: #f0f0f0; cursor: pointer; flex-grow: 1; }
        
        #draw-button { width: 100%; padding: 12px; background-color: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; }


        /* --- 2. ä¸‹æ–¹ï¼šè¦–è¦ºåŒ–å€ --- */
        #visualization { flex-grow: 1; position: relative; width: 100%; padding: 20px; box-sizing: border-box; }
        #visualization canvas { display: block; }
        .css2d-container { position: absolute; top: 0; left: 0; z-index: 10; }
        
        #info-panel { position: absolute; top: 10px; right: 10px; background: rgba(44, 62, 80, 0.9); color: white; padding: 15px; border-radius: 8px; z-index: 20; width: 280px; font-size: 14px; }
        .data-label { font-weight: bold; color: #f1c40f; }
        .pre-draw-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; color: #2c3e50; background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 8px; pointer-events: none; z-index: 30; }
    </style>
</head>
<body>

    <div id="controls">
        <h2>ğŸ“Š å½ˆæ€§ä¸‰è§’æ¸¬é‡åƒæ•¸è¼¸å…¥</h2>
        <div class="input-tip">
            **åæ¨™ç³»ï¼šX=å— (X+), Y=æ± (Y+), Z=é«˜å¡” (Z+)**<br>
            **æ–¹ä½è§’ï¼šå¾ Y+ (æ­£æ±) è»¸é †æ™‚é‡æ—‹è½‰ã€‚**
        </div>
        
        <div id="input-content">
            <div class="setting-group">
                <h3>ğŸ—¼ é«˜å¡”èˆ‡è·é›¢</h3>
                <label for="height">é«˜å¡” CD é«˜åº¦ (h, Zè»¸, å¯é¸å¡«)</label>
                <input type="number" id="height" value="" min="0" step="0.1">
                <label for="ab-dist-input">è§€æ¸¬é» AB è·é›¢ (d, å¯é¸å¡«)</label>
                <input type="number" id="ab-dist-input" value="400" min="0" step="0.1">
            </div>

            <div class="setting-group">
                <h3>ğŸ“ è§€æ¸¬é» A (C é»ç‚ºä¸­å¿ƒ)</h3>
                <label>æ–¹ä½è¨­å®š</label>
                <div class="azimuth-input">
                    <select id="a-dir1"> <option value="E" selected>æ±</option> <option value="W">è¥¿</option> </select>
                    <span>å</span>
                    <select id="a-dir2"> <option value="S" selected>å—</option> <option value="N">åŒ—</option> </select>
                    <input type="number" id="a-angle" value="0" min="0" max="90" step="0.1">
                    <span>åº¦</span>
                </div>
                <label for="a-dist">æ°´å¹³è·é›¢ AC ($d_A$, å¯é¸å¡«)</label>
                <input type="number" id="a-dist" value="" min="0" step="0.1">
                <label for="a-elevation">ä»°è§’ $\angle CAD$ ($\theta_A$, å¯é¸å¡«)</label>
                <input type="number" id="a-elevation" value="30" min="0" max="89.9" step="0.1">
            </div>

            <div class="setting-group">
                <h3>ğŸ“Œ è§€æ¸¬é» B (C é»ç‚ºä¸­å¿ƒ)</h3>
                <label>æ–¹ä½è¨­å®š</label>
                <div class="azimuth-input">
                    <select id="b-dir1"> <option value="E" selected>æ±</option> <option value="W">è¥¿</option> </select>
                    <span>å</span>
                    <select id="b-dir2"> <option value="S" selected>å—</option> <option value="N">åŒ—</option> </select>
                    <input type="number" id="b-angle" value="60" min="0" max="90" step="0.1">
                    <span>åº¦</span>
                </div>
                <label for="b-dist">æ°´å¹³è·é›¢ BC ($d_B$, å¯é¸å¡«)</label>
                <input type="number" id="b-dist" value="" min="0" step="0.1">
                <label for="b-elevation">ä»°è§’ $\angle CBD$ ($\theta_B$, å¯é¸å¡«)</label>
                <input type="number" id="b-elevation" value="60" min="0" max="89.9" step="0.1">
            </div>
        </div>

        <button id="draw-button" onclick="reDrawSafely()">
            ç¹ªè£½åœ–å½¢
        </button>

        <div class="setting-group">
            <h3>ğŸ–±ï¸ åœ–å½¢æ§åˆ¶æŒ‰éˆ•</h3>
            <div class="control-buttons">
                <div class="control-row">
                    <button onclick="rotateView('Y-')">â¬…ï¸ æ°´å¹³å·¦è½‰</button>
                    <button onclick="rotateView('Y+')">â¡ï¸ æ°´å¹³å³è½‰</button>
                </div>
                <div class="control-row">
                    <button onclick="rotateView('X+')">â¬†ï¸ å‚ç›´ä¸Šä»°</button>
                    <button onclick="rotateView('X-')">â¬‡ï¸ å‚ç›´ä¸‹ä¿¯</button>
                </div>
                <div class="control-row">
                    <button onclick="zoomView('+')">ğŸ” æ”¾å¤§</button>
                    <button onclick="zoomView('-')">ğŸ” ç¸®å°</button>
                </div>
                <div class="control-row">
                    <button onclick="panView('UP')">ğŸ”¼ ä¸Šç§»</button>
                    <button onclick="panView('DOWN')">ğŸ”½ ä¸‹ç§»</button>
                    <button onclick="panView('LEFT')">â—€ï¸ å·¦ç§»</button>
                    <button onclick="panView('RIGHT')">â–¶ï¸ å³ç§»</button>
                </div>
            </div>
        </div>
    </div>

    <div id="visualization">
        
        <div id="info-panel">
            <h3>ğŸ–±ï¸ åœ–å½¢æ“ä½œèˆ‡è¨ˆç®—çµæœ</h3>
            
            <p><strong>æ—‹è½‰ (Rotate):</strong> æŒ‰ä¸‹æŒ‰éˆ•æ§åˆ¶è¦–è§’</p>
            <p><strong>ç¸®æ”¾ (Zoom):</strong> æŒ‰ä¸‹æŒ‰éˆ•æ§åˆ¶æ¯”ä¾‹</p>
            <p><strong>å¹³ç§» (Pan):</strong> æŒ‰ä¸‹æŒ‰éˆ•æ§åˆ¶ä½ç½®</p>
            <hr style="border-color: #5d6d7e;">

            <p><span class="data-label">å¡”é«˜ CD (h):</span> <span id="out-cd">N/A</span> m</p>
            <p><span class="data-label">æ°´å¹³è· AC ($d_A$):</span> <span id="out-ac">N/A</span> m</p>
            <p><span class="data-label">ä»°è§’ âˆ CAD ($\theta_A$):</span> <span id="out-cad">N/A</span> Â°</p>
            <p><span class="data-label">æ°´å¹³è· BC ($d_B$):</span> <span id="out-bc">N/A</span> m</p>
            <p><span class="data-label">ä»°è§’ âˆ CBD ($\theta_B$):</span> <span id="out-cbd">N/A</span> Â°</p>
            <p><span class="data-label">å…©é»è· AB (d):</span> <span id="out-ab">N/A</span> m</p>
            <p><span class="data-label">åœ°é¢è§’ âˆ ACB:</span> <span id="out-acb">N/A</span> Â°</p>
        </div>
        
        <div id="pre-draw-message" class="pre-draw-text">
            ğŸ‘† è«‹è¼¸å…¥åƒæ•¸ä¸¦é»æ“Šã€Œç¹ªè£½åœ–å½¢ã€
        </div>
    </div>

    <script>
        // --- è®Šæ•¸èˆ‡è¼”åŠ©å‡½å¼å®šç¾© ---
        let scene, camera, renderer, labelRenderer, controls;
        const visualizationDiv = document.getElementById('visualization');
        const DEG_TO_RAD = Math.PI / 180;
        
        // --- æ ¸å¿ƒåˆå§‹åŒ–å‡½å¼ ---
        function initThreeJS() {
            const oldLabelContainer = document.querySelector('.css2d-container');
            if (renderer) visualizationDiv.removeChild(renderer.domElement);
            if (oldLabelContainer) visualizationDiv.removeChild(oldLabelContainer);
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xecf0f1);

            // å°ºå¯¸å¥å£¯æ€§ä¿®æ­£ï¼šç¢ºä¿å°ºå¯¸éé›¶
            const width = visualizationDiv.offsetWidth || window.innerWidth;
            const height = visualizationDiv.offsetHeight || window.innerHeight;
            const aspect = width / height;
            
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            camera.up.set(0, 0, 1); // Z è»¸ç‚ºå‚ç›´æ–¹å‘
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            visualizationDiv.appendChild(renderer.domElement);
            
            labelRenderer = new THREE.CSS2DRenderer();
            labelRenderer.setSize(width, height);
            labelRenderer.domElement.className = 'css2d-container'; 
            visualizationDiv.appendChild(labelRenderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement); 
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            controls.enableZoom = false; controls.enableRotate = false; controls.enablePan = false;
            controls.update(); 

            scene.add(new THREE.AmbientLight(0x404040));
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(100, 200, 100);
            scene.add(directionalLight);

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function onWindowResize() {
            const width = visualizationDiv.clientWidth;
            const height = visualizationDiv.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
            labelRenderer.setSize(width, height);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            labelRenderer.render(scene, camera);
        }

        // --- æ ¸å¿ƒäº’å‹•æ§åˆ¶å‡½å¼ (æŒ‰éˆ•æ“ä½œ) ---
        const ROTATE_STEP = 5 * DEG_TO_RAD; 
        const PAN_STEP = 50; 
        const ZOOM_FACTOR = 1.1;

        function rotateView(direction) {
            if (!controls) return;
            switch (direction) {
                case 'Y-': controls.rotateLeft(ROTATE_STEP); break; 
                case 'Y+': controls.rotateLeft(-ROTATE_STEP); break; 
                case 'X+': controls.rotateUp(ROTATE_STEP); break; 
                case 'X-': controls.rotateUp(-ROTATE_STEP); break; 
            }
            controls.update();
        }

        function zoomView(direction) {
            if (!controls) return;
            if (direction === '+') {
                controls.dollyIn(ZOOM_FACTOR); 
            } else {
                controls.dollyOut(ZOOM_FACTOR); 
            }
            controls.update();
        }

        function panView(direction) {
            if (!controls) return;
            switch (direction) {
                case 'UP': controls.pan(0, PAN_STEP); break;
                case 'DOWN': controls.pan(0, -PAN_STEP); break;
                case 'LEFT': controls.pan(PAN_STEP, 0); break;
                case 'RIGHT': controls.pan(-PAN_STEP, 0); break;
            }
            controls.update();
        }
        
        // --- å°ºå¯¸å®‰å…¨é‡ç¹ªå‡½å¼ (ç¶å®šåˆ°æŒ‰éˆ•) ---
        function reDrawSafely() {
            // 1. å¼·åˆ¶æ›´æ–°æ¸²æŸ“å™¨å°ºå¯¸
            const width = visualizationDiv.offsetWidth;
            const height = visualizationDiv.offsetHeight;
            if (renderer && width > 0 && height > 0) {
                renderer.setSize(width, height);
                labelRenderer.setSize(width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
            } else if (width === 0 || height === 0) {
                 alert("ç¹ªåœ–å€å°ºå¯¸ç„¡æ•ˆï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨çª—å£å¤§å°æˆ–ç­‰å¾…é é¢åŠ è¼‰å®Œæˆã€‚");
                 return;
            }
            
            // 2. è§¸ç™¼ç¹ªåœ–
            draw3DScene();
        }

        // (æ•¸å­¸/ç¹ªåœ–è¼”åŠ©å‡½å¼åŠæ ¸å¿ƒé‚è¼¯ä¿æŒä¸è®Š)
        function azimuthToRadians(dir1, dir2, angleDeg) {
            if (isNaN(angleDeg)) angleDeg = 0;
            const angleRad = angleDeg * DEG_TO_RAD;
            let totalAngleRad = 0;

            if (dir1 === 'E' && dir2 === 'S') { totalAngleRad = angleRad; }
            else if (dir1 === 'W' && dir2 === 'S') { totalAngleRad = Math.PI - angleRad; }
            else if (dir1 === 'W' && dir2 === 'N') { totalAngleRad = Math.PI + angleRad; }
            else if (dir1 === 'E' && dir2 === 'N') { totalAngleRad = 2 * Math.PI - angleRad; }
            
            if (angleDeg === 0) {
                 if (dir1 === 'W') totalAngleRad = Math.PI;
                 else totalAngleRad = 0;
            } else if (angleDeg === 90) {
                 if (dir2 === 'S') totalAngleRad = Math.PI / 2;
                 else totalAngleRad = 3 * Math.PI / 2;
            }
            
            return totalAngleRad;
        }

        function drawLine(v1, v2, material, isDashed = false) {
            const points = [v1, v2];
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const line = new THREE.Line(geometry, material);
            if (isDashed) { line.computeLineDistances(); }
            return line;
        }

        function addSphere(position, color, labelText) {
            const geometry = new THREE.SphereGeometry(3, 16, 16);
            const material = new THREE.MeshBasicMaterial({ color: color });
            const sphere = new THREE.Mesh(geometry, material);
            sphere.position.copy(position);
            scene.add(sphere);
            
            const div = document.createElement('div');
            div.className = 'label';
            div.textContent = labelText;
            const label = new THREE.CSS2DObject(div);
            label.position.copy(position.clone().add(new THREE.Vector3(0, 0, 5)));
            scene.add(label);
        }
        
        function addLabel(position, text, className) {
            const div = document.createElement('div');
            div.className = className;
            div.textContent = text;
            const label = new THREE.CSS2DObject(div);
            label.position.copy(position);
            scene.add(label);
        }

        function drawDefaultScene() {
            if (!scene) initThreeJS();
            scene.children.length = 0;
            
            const defaultH = 100;
            const defaultRadius = 150;
            
            const C = new THREE.Vector3(0, 0, 0);
            const D = new THREE.Vector3(0, 0, defaultH);
            const black = new THREE.LineBasicMaterial({ color: 0x000000 }); 
            scene.add(drawLine(C, D, black));
            addSphere(C, 0x000000, "C"); 
            addSphere(D, 0x000000, "D"); 

            camera.position.set(defaultRadius * 1.0, defaultRadius * 1.0, defaultH * 1.5);
            controls.target.set(0, 0, defaultH / 2);
            controls.update();

            updateOutputPanel(NaN, NaN, NaN, { CAD: NaN, CBD: NaN, ACB: NaN, AB: NaN });
            
            document.getElementById('pre-draw-message').style.display = 'block';
        }

        function solveTriangle(input, angleACB) {
            let { h, dA, dB, thetaA, thetaB, d } = input;
            
            const cotA = thetaA > 0 && thetaA < 90 ? (1 / Math.tan(thetaA * DEG_TO_RAD)) : NaN;
            const cotB = thetaB > 0 && thetaB < 90 ? (1 / Math.tan(thetaB * DEG_TO_RAD)) : NaN;
            
            if (!isNaN(cotA) && !isNaN(cotB) && d > 0 && isNaN(h) && isNaN(dA) && isNaN(dB)) {
                const cosACB = Math.cos(angleACB);
                const term = cotA * cotA + cotB * cotB - 2 * cotA * cotB * cosACB;
                
                if (term > 1e-6) { 
                    h = Math.sqrt((d * d) / term);
                    dA = h * cotA;
                    dB = h * cotB;
                    if (h > 0 && dA > 0 && dB > 0) return { h, dA, dB, d };
                } else {
                    return null;
                }
            }

            if (h > 0) {
                if (isNaN(dA) && !isNaN(cotA)) dA = h * cotA;
                if (isNaN(dB) && !isNaN(cotB)) dB = h * cotB;
            }

            if (isNaN(h)) {
                if (dA > 0 && !isNaN(cotA)) h = dA / cotA;
                else if (dB > 0 && !isNaN(cotB)) h = dB / cotB;
            }

            if (h > 0 && dA > 0 && dB > 0) {
                const dCalc = Math.sqrt(dA * dA + dB * dB - 2 * dA * dB * Math.cos(angleACB));
                d = isNaN(d) || d === 0 ? dCalc : d;
                return { h, dA, dB, d: dCalc };
            }
            
             if (h > 0 && d > 0 && dA > 0) {
                const a = 1;
                const b = -2 * dA * Math.cos(angleACB);
                const c = dA * dA - d * d;
                const discriminant = b * b - 4 * a * c;
                if (discriminant >= 0) {
                    dB = (-b + Math.sqrt(discriminant)) / (2 * a);
                    if (dB > 0) return { h, dA, dB, d };
                }
            }
            if (h > 0 && d > 0 && dB > 0) {
                const a = 1;
                const b = -2 * dB * Math.cos(angleACB);
                const c = dB * dB - d * d;
                const discriminant = b * b - 4 * a * c;
                if (discriminant >= 0) {
                    dA = (-b + Math.sqrt(discriminant)) / (2 * a);
                    if (dA > 0) return { h, dA, dB, d };
                }
            }
            
            return null;
        }


        function draw3DScene() {
            document.getElementById('pre-draw-message').style.display = 'none';

            const getNum = (id) => {
                const val = document.getElementById(id).value;
                return val === "" ? NaN : parseFloat(val);
            };

            const input = {
                h: getNum('height'), d: getNum('ab-dist-input'), dA: getNum('a-dist'), dB: getNum('b-dist'),
                thetaA: getNum('a-elevation'), thetaB: getNum('b-elevation'),
                aDir1: document.getElementById('a-dir1').value, aDir2: document.getElementById('a-dir2').value, aAngle: getNum('a-angle'),
                bDir1: document.getElementById('b-dir1').value, bDir2: document.getElementById('b-dir2').value, bAngle: getNum('b-angle')
            };
            
            const aRad = azimuthToRadians(input.aDir1, input.aDir2, input.aAngle);
            const bRad = azimuthToRadians(input.bDir1, input.bDir2, input.bAngle);
            let radACB = Math.abs(aRad - bRad);
            if (radACB > Math.PI) {
                radACB = 2 * Math.PI - radACB;
            }
            
            const solution = solveTriangle(input, radACB);

            if (!solution) {
                alert("éŒ¯èª¤ï¼šè¼¸å…¥æ¢ä»¶ä¸è¶³æˆ–æ•¸æ“šçŸ›ç›¾ã€‚è«‹æª¢æŸ¥æ˜¯å¦æä¾›äº†è‡³å°‘ä¸‰å€‹ç¨ç«‹æ¢ä»¶ã€‚");
                drawDefaultScene();
                return;
            }

            const { h, dA, dB, d } = solution;
            
            scene.children.length = 0; 
            
            const C = new THREE.Vector3(0, 0, 0);
            const D = new THREE.Vector3(0, 0, h); 

            const Ax = dA * Math.sin(aRad);
            const Ay = dA * Math.cos(aRad);
            const A = new THREE.Vector3(Ax, Ay, 0);

            const Bx = dB * Math.sin(bRad);
            const By = dB * Math.cos(bRad);
            const B = new THREE.Vector3(Bx, By, 0);

            const maxDist = Math.max(dA, dB, h, d, 100);
            
            // æ”å½±æ©Ÿå„ªåŒ–
            camera.position.set(maxDist * 1.2, maxDist * 2.5, maxDist * 1.5);
            controls.target.set(0, 0, h / 2);
            controls.update();

            // ç¹ªè£½é€£ç·š (åªä¿ç•™é€£ç·šå’Œé»)
            const black = new THREE.LineBasicMaterial({ color: 0x000000 });
            const green = new THREE.LineBasicMaterial({ color: 0x27ae60 });
            const blue = new THREE.LineBasicMaterial({ color: 0x3498db });
            const red = new THREE.LineBasicMaterial({ color: 0xe74c3c });
            const greenDashed = new THREE.LineDashedMaterial({ color: 0x27ae60, dashSize: 5, gapSize: 3 });
            const blueDashed = new THREE.LineDashedMaterial({ color: 0x3498db, dashSize: 5, gapSize: 3 });
            
            scene.add(drawLine(C, D, black)); 
            scene.add(drawLine(C, A, green)); 
            scene.add(drawLine(C, B, blue)); 
            scene.add(drawLine(A, B, red)); 
            scene.add(drawLine(A, D, greenDashed, true)); 
            scene.add(drawLine(B, D, blueDashed, true)); 
            
            // ç¹ªè£½å››å€‹é»
            addSphere(C, 0x000000, "C"); addSphere(D, 0x000000, "D"); 
            addSphere(A, 0x27ae60, "A"); addSphere(B, 0x3498db, "B");

            // 7. è¼¸å‡ºçµæœ
            const finalThetaA = Math.atan(h / dA) * 180 / Math.PI;
            const finalThetaB = Math.atan(h / dB) * 180 / Math.PI;
            
            const results = {
                CAD: finalThetaA.toFixed(2),
                CBD: finalThetaB.toFixed(2),
                ACB: (radACB * 180 / Math.PI).toFixed(2),
                AB: d.toFixed(2)
            };

            updateOutputPanel(h, dA, dB, results);
        }

        function updateOutputPanel(h, dA, dB, results) {
            document.getElementById('out-cd').textContent = isNaN(h) ? "N/A" : h.toFixed(2);
            document.getElementById('out-ac').textContent = isNaN(dA) ? "N/A" : dA.toFixed(2);
            document.getElementById('out-cad').textContent = isNaN(results.CAD) ? "N/A" : results.CAD;
            document.getElementById('out-bc').textContent = isNaN(dB) ? "N/A" : dB.toFixed(2);
            document.getElementById('out-cbd').textContent = isNaN(results.CBD) ? "N/A" : results.CBD;
            document.getElementById('out-ab').textContent = isNaN(results.AB) ? "N/A" : results.AB;
            document.getElementById('out-acb').textContent = isNaN(results.ACB) ? "N/A" : results.ACB;
        }

        // ç¶²é è¼‰å…¥å¾Œï¼Œå…ˆåˆå§‹åŒ– Three.js å ´æ™¯ï¼Œç„¶å¾Œç¹ªè£½é è¨­å ´æ™¯
        window.onload = function() {
            initThreeJS();
            drawDefaultScene();
            
            // è¼‰å…¥æ™‚è‡ªå‹•å¡«å…¥æ‚¨æä¾›çš„åƒæ•¸ï¼Œæ–¹ä¾¿æ¸¬è©¦
            document.getElementById('ab-dist-input').value = 400;
            document.getElementById('a-elevation').value = 30;
            document.getElementById('a-dir1').value = 'E';
            document.getElementById('a-dir2').value = 'S';
            document.getElementById('a-angle').value = 0;
            document.getElementById('b-elevation').value = 60;
            document.getElementById('b-dir1').value = 'E';
            document.getElementById('b-dir2').value = 'S';
            document.getElementById('b-angle').value = 60;
        };
    </script>

</body>
</html>